<odoo>
    <data>
        <!--======== FORM VIEW ======== -->
        <record model="ir.ui.view" id="view_order_form_inherited_omydoo">
          <field name="name">view_order_form_inherited</field>
          <field name="model">sale.order</field>
          <field name="inherit_id" ref="sale.view_order_form"/>
          <field name="arch" type="xml">

            <!-- Ajout du champ nom_chantier_volta dans les bons de commande -->
            <xpath expr="/form/sheet/notebook/page" position="inside">
                <field name="sign_and_accept_customized" invisible="1"/>
                <field name="review_sign_and_accept_customized" invisible="1"/>
            </xpath>

          </field>
        </record>
    </data>

    <!--======== sale_order_portal_template VIEW ========-->
    <template id="sale_order_portal_template_inherit_omydoo" inherit_id="sale.sale_order_portal_template">
        <!-- Replace 'Sign & Accept' by the custom field -->
        <xpath expr="//div/t/t[3]/ul/li[1]/a[1]" position="replace">
            <a t-if="sale_order.has_to_be_signed(True)" role="button" class="btn btn-primary btn-block mb8" data-toggle="modal" data-target="#modalaccept" href="#">
                <i class="fa fa-check"/><t t-esc="sale_order.sign_and_accept_customized"/>
            </a>
        </xpath>
        <xpath expr="//div/t/t[3]/ul/li[1]/a[@id='o_sale_portal_paynow']" position="replace">
            <a t-elif="sale_order.has_to_be_paid(True)" role="button" id="o_sale_portal_paynow" data-toggle="modal" data-target="#modalaccept" href="#" t-att-class="'btn-block mb8 %s' % ('btn btn-light' if sale_order.transaction_ids else 'btn btn-primary')" >
                <i class="fa fa-check"/><t t-esc="sale_order.sign_and_accept_customized"/>
            </a>
        </xpath>
    </template>

    <!--======== 	mail_notification_paynow_online VIEW ========-->
    <template id="mail_notification_paynow_online_inherit_omydoo" inherit_id="sale.mail_notification_paynow_online">
        <!-- Replace 'Sign & Accept' by the custom field -->

        <xpath expr="//t[@t-if=&#34;record._name == 'sale.order'&#34;]" position="replace">
             <t t-if="record._name == 'sale.order'">
                    <t t-set="is_transaction_pending" t-value="record.get_portal_last_transaction().state == 'pending'"/>
                    <t t-if="record.has_to_be_signed(include_draft=True)">
                        <t t-if="record.has_to_be_paid()" t-set="access_name">
                            <t t-if="is_transaction_pending">
                               <t t-esc="record.review_sign_and_accept_customized"/>
                            </t>
                            <t t-else="">
                               <t t-esc="record.review_sign_and_accept_customized"/>
                            </t>
                        </t>
                        <t t-else="" t-set="access_name">
                            <t t-esc="record.review_sign_and_accept_customized"/>
                        </t>
                    </t>
                    <t t-elif="record.has_to_be_paid(include_draft=True) and not is_transaction_pending" t-set="access_name">
                       <t t-esc="record.review_sign_and_accept_customized"/>
                    </t>
                    <t t-elif="record.state in ('draft', 'sent')" t-set="access_name">
                        <t t-esc="record.review_sign_and_accept_customized"/>
                    </t>
                </t>
        </xpath>

    </template>
</odoo>


